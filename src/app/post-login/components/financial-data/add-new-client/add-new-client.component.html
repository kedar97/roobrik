<div class="d-flex gap-4">
    <div class="main-container" [class.custom-padding-right]="!isAddFlyOutOpen">
        <div class="section-header">
            <div class="heading-text d-flex">
                <img src="assets/images/person-pin-outline-rounded.svg" alt="Bar-chart icon">
                <h1>{{pageTitle}}</h1>
            </div>
            <div class="search-section">
                <div class="input-container">
                    <input
                        type="text"
                        placeholder="Search"
                        id="filter-text-box"
                        (input)="onSearch()"
                    >
                    <img src="assets/images/search-icon.png" alt="Search icon">
                </div>
                <button *ngIf="isUndoAvailable > 0" class="btn btn-undo-redo" (click)="onUndo()">
                    <img class="undo-redo-icon" src="assets/images/undo.svg" />
                    UNDO
                </button>
                <button *ngIf="isRedoAvailable > 0" class="btn btn-undo-redo" (click)="onRedo()">
                    <img class="undo-redo-icon" src="assets/images/redo.svg" />
                    REDO
                </button>
                <div class="d-flex gap-2" *ngIf="isNewClientSaved">                   
                    <button class="btn btn-export" (click)="onAddNewRow()">ADD ROW</button>
                    <button class="btn btn-create-new" (click)="onSave()">SAVE</button>
                </div>
            </div>
        </div>
    
        <div class="table-section">
            <ag-grid-angular
                style="flex-grow: 1; height: 655px"
                class="ag-theme-balham ag-grid"
                [rowHeight]="36"
                [columnDefs]="columnDef"
                [rowData]="rowData"
                [defaultColDef]="defaultColDef"
                [gridOptions]="gridOptions"
                [sideBar]="sideBar"
                [rowSelection]="rowSelection"
                [autoGroupColumnDef]="autoGroupColumnDef"
                [treeData]="true"
                [groupSelectsChildren]="true"
                [getDataPath]="getDataPath"
                [enableRangeSelection]="true"
                [enableFillHandle]="true"
                [undoRedoCellEditing]="true"
                [undoRedoCellEditingLimit]="undoRedoCellEditingLimit"
                [enableCellChangeFlash]="true"
                (cellValueChanged)="onCellValueChanged($event)"
                (selectionChanged)="onSelectionChanged($event)"
                (toolPanelVisibleChanged)="onToolPanelVisibleChanged($event)"
                [pagination]="true"
                [groupDefaultExpanded]="groupDefaultExpanded"
                (filterChanged)="onFilterChanged($event)"
                (gridReady)="onGridReady($event)"
                >
            </ag-grid-angular>
    
            <div class="status-bar-text" *ngIf="selectedNodes.length > 0 && rowIndex !=null">
                <p>Rows: <span>{{rowIndex+1}} of {{totalRows}}</span></p>
            </div>
    
            <select
                class="items-dropdown"
                [(ngModel)]="selectedValue"
                (change)="onItemsPerPageChange(selectedValue)"
            >
                <option
                *ngFor="let option of paginationOptions"
                [attr.selected]="option.value == 10"
                [value]="option.value"
                >
                {{ option.title }}
                </option>
            </select>
        </div>
    </div>

    
    <div class="add-new-section" *ngIf="isAddFlyOutOpen">
        <img src="assets/images/close-icon-black.svg" alt="Close Icon" class="close-icon" (click)="onAddFlyOutClose()">
        <h1 class="add-new-section-header">Create New Client</h1>

        <form class="k-form k-form-md" [formGroup]="form" (ngSubmit)="onSaveChanges(form)">
            <div class="formSection d-flex flex-column custom-gap-5">
                <kendo-formfield>
                    <div class="dropdown-title-container">
                        <kendo-label class="label-text">Client Name</kendo-label>
                        <div class="add-dropdown" *ngIf="clientDropdownTextbox" (click)="activateDropdown('client')">Activate Dropdown</div>
                    </div>
                   <kendo-dropdownlist
                        *ngIf="!clientDropdownTextbox"
                         formControlName="clientName"
                         [data]="clientNameList"
                         onSaveChanges
                         [valuePrimitive] =true
                         textField="name"
                         valueField="id"
                         [filterable]="true"
                         class="dropdown"
                         (open)="formDropDownOpen('clientname')"
                         (close)="formDropDownClose()"
                         (valueChange)="onClientDropDownValueChange($event, 'client')"
                         [class.dropdown-open]="isClientDropDownOpen"
                         (filterChange)="handleFilter($event, 'client')"
                    >
                   </kendo-dropdownlist>
                   <input
                        *ngIf="clientDropdownTextbox"
                        formControlName="clientName"
                        kendoTextBox
                    >
                </kendo-formfield>

                <kendo-formfield>
                    <div class="dropdown-title-container">
                        <kendo-label class="label-text">Invoicing Entity</kendo-label>
                        <div class="add-dropdown" *ngIf="invoicingDropdownTextbox" (click)="activateDropdown('invoicing')">Activate Dropdown</div>
                    </div>
                    <kendo-dropdownlist
                        *ngIf="!invoicingDropdownTextbox"
                        formControlName="invoicingEntity"
                        [data]="invoicingEntityList"
                        textField="name"
                        valueField="id"
                        [filterable]="true"
                        [valuePrimitive]=true
                        class="dropdown"
                        (open)="formDropDownOpen('invoicingEntity')"
                        (close)="formDropDownClose()"
                        (valueChange)="onClientDropDownValueChange($event, 'invoicing')"
                        [class.dropdown-open]="isInvoicingDropDownOpen"
                        (filterChange)="handleFilter($event, 'invoicing')"

                     >
                    </kendo-dropdownlist>
                    <input
                        *ngIf="invoicingDropdownTextbox"
                        formControlName="invoicingEntity"
                        kendoTextBox
                    >
                 </kendo-formfield>  

                 <kendo-formfield>
                    <div class="dropdown-title-container">
                        <kendo-label class="label-text">Legal Entity</kendo-label>
                        <div class="add-dropdown" *ngIf="legalDropdownTextbox" (click)="activateDropdown('legal')">Activate Dropdown</div>
                    </div>
                    <kendo-dropdownlist
                        *ngIf="!legalDropdownTextbox"
                        formControlName="legalEntity"
                        [data]="legalEntityList"
                        [filterable]="true"
                        textField="name"
                        valueField="id"
                        [valuePrimitive]=true
                        class="dropdown"
                        (open)="formDropDownOpen('legalEntity')"
                        (close)="formDropDownClose()"
                        (valueChange)="onClientDropDownValueChange($event, 'legal')"
                        [class.dropdown-open]="isLegalDropDownOpen"
                        (filterChange)="handleFilter($event, 'legal')"
                     >
                    </kendo-dropdownlist>
                    <input
                        *ngIf="legalDropdownTextbox"
                        formControlName="legalEntity"
                        kendoTextBox
                    >
                 </kendo-formfield>  

                 <kendo-formfield>
                    <div class="d-flex gap-2 align-items-center margin-bottom-8">
                        <kendo-label class="label-text mb-0">Starting Franchise Count</kendo-label>
                        <div kendoTooltip filter="strong" class="custom-margin-top-2">
                            <strong title="Do not include the default/corporate site in this count">
                                <img src="assets/images/information-circle-icon.png" alt="Info Icon" class="info-icon">
                            </strong>                        
                        </div>
                    </div>
                    <input
                        formControlName="franchiseCount"
                        kendoTextBox
                        pattern="^(?!.*e)[0-9]*$"
                    />
                 </kendo-formfield>

                 <div class="buttons-container d-flex gap-2">
                    <button class="btn btn-create-new" type="submit" [disabled]="!form.valid">Save Changes</button>
                    <button class="btn btn-export" (click)="onAddFlyOutClose()">Cancel</button>
                </div>
            </div>
        </form>
    </div>
</div>


